{"version":3,"file":"browser.es2015.es.js","sources":["../src/index.js"],"sourcesContent":["/* eslint-env browser */\n\nconst DECL_REGEX = /.([^:{]+)(:[^{]+)?{([^}]+)}/g;\n\nimport StyletronCore from 'styletron-core';\n\n/**\n * A Styletron class for rendering styles in the browser\n * @extends StyletronCore\n * @packagename styletron-client\n * @example\n * const elements = document.getElementsByClassName('_styletron_hydrate_');\n * const styletron = new StyletronClient(elements);\n */\nclass StyletronClient extends StyletronCore {\n  /**\n   * Create a new StyletronClient instance\n   * @param {NodeList|HTMLCollection|HTMLStyleElement[]} [serverStyles] - List of server style elements\n   * @param {object} [opts] - StyletronCore options\n   */\n  constructor(serverStyles, opts) {\n    super(opts);\n    this.uniqueCount = 0;\n    this.mediaSheets = {};\n    if (serverStyles && serverStyles.length > 0) {\n      for (let i = 0; i < serverStyles.length; i++) {\n        const element = serverStyles[i];\n        if (element.media) {\n          this.mediaSheets[element.media] = element;\n        } else {\n          this.mainSheet = element;\n        }\n        this.hydrateCacheFromCssString(element.textContent, element.media);\n      }\n    } else {\n      const styleSheet = document.createElement('style');\n      document.head.appendChild(styleSheet);\n      this.mainSheet = styleSheet;\n    }\n  }\n\n  /*\n   * Hydrate the cache from a css string and media string\n   * @param {string} css   - The stylesheet css content\n   * @param {string} media - The stylesheet media string\n   */\n  hydrateCacheFromCssString(css, media) {\n    let decl;\n    // {\n    //  1: className,\n    //  2: pseudo,\n    //  3: block,\n    // }\n    while ((decl = DECL_REGEX.exec(css))) {\n      super.incrementVirtualCount();\n      StyletronCore.assignDecl(\n        this.cache,\n        {\n          block: decl[3],\n          pseudo: decl[2],\n          media,\n        },\n        decl[1]\n      );\n    }\n  }\n\n  /**\n   * Inject declaration into the stylesheet and return the unique class name\n   * @return {string}      class name\n   * @example\n   * // <style id=\"styletron\">.a{color:red}</style>\n   * const styletron = new StyletronClient(document.getElementsByClassName('_styletron_hydrate_'));\n   * styletron.injectDeclaration({prop: 'color', val: 'blue'});\n   * // → 'b'\n   * styletron.injectDeclaration({prop: 'color', val: 'red', media: '(min-width: 800px)'});\n   * // → 'c'\n   * styletron.injectDeclaration({prop: 'color', val: 'red'});\n   * // → 'a'\n   */\n  injectDeclaration({prop, val, media, pseudo}) {\n    return this.injectRawDeclaration({block: `${prop}:${val}`, media, pseudo});\n  }\n\n  /**\n   * Inject raw declaration into the stylesheet and return the unique class name\n   * @return {string}      class name\n   * @example\n   * // <style id=\"styletron\">.a{color:red}</style>\n   * const styletron = new StyletronClient(document.getElementsByClassName('_styletron_hydrate_'));\n   * styletron.injectRawDeclaration({block: 'color:blue'});\n   * // → 'b'\n   * styletron.injectRawDeclaration({block: 'color:red', media: '(min-width: 800px)'});\n   * // → 'c'\n   * styletron.injectRawDeclaration({block: 'color:red'});\n   * // → 'a'\n   */\n  injectRawDeclaration(decl) {\n    const oldCount = this.uniqueCount;\n    const className = super.injectRawDeclaration(decl);\n    if (oldCount !== this.uniqueCount) {\n      const rule = declarationToRule(className, decl);\n      let sheet;\n      if (decl.media) {\n        if (!this.mediaSheets[decl.media]) {\n          const mediaSheet = document.createElement('style');\n          mediaSheet.media = decl.media;\n          this.mediaSheets[decl.media] = mediaSheet;\n          this.mainSheet.parentNode.appendChild(mediaSheet);\n        }\n        sheet = this.mediaSheets[decl.media].sheet;\n      } else {\n        sheet = this.mainSheet.sheet;\n      }\n      sheet.insertRule(rule, sheet.cssRules.length);\n    }\n    return className;\n  }\n}\n\nexport default StyletronClient;\n\n/*\n * Injection helpers\n */\n\nfunction declarationToRule(className, {block, pseudo}) {\n  let selector = `.${className}`;\n  if (pseudo) {\n    selector += pseudo;\n  }\n  return `${selector}{${block}}`;\n}\n"],"names":["DECL_REGEX","StyletronClient","StyletronCore","serverStyles","opts","uniqueCount","mediaSheets","length","i","element","media","mainSheet","hydrateCacheFromCssString","textContent","styleSheet","document","createElement","head","appendChild","css","decl","exec","incrementVirtualCount","assignDecl","cache","injectRawDeclaration","prop","val","oldCount","className","rule","declarationToRule","sheet","mediaSheet","parentNode","insertRule","cssRules","selector","pseudo","block"],"mappings":";;AAAA;AAEA,MAAMA,aAAa,8BAAnB;AAEA,AAEA;;;;;;;;;AAQA,MAAMC,eAAN,SAA8BC,aAA9B,CAA4C;;;;;;cAM9BC,YAAZ,EAA0BC,IAA1B,EAAgC;UACxBA,IAAN;SACKC,WAAL,GAAmB,CAAnB;SACKC,WAAL,GAAmB,EAAnB;;QACIH,gBAAgBA,aAAaI,MAAb,GAAsB,CAA1C,EAA6C;WACtC,IAAIC,IAAI,CAAb,EAAgBA,IAAIL,aAAaI,MAAjC,EAAyCC,GAAzC,EAA8C;cACtCC,UAAUN,aAAaK,CAAb,CAAhB;;YACIC,QAAQC,KAAZ,EAAmB;eACZJ,WAAL,CAAiBG,QAAQC,KAAzB,IAAkCD,OAAlC;SADF,MAEO;eACAE,SAAL,GAAiBF,OAAjB;;;aAEGG,yBAAL,CAA+BH,QAAQI,WAAvC,EAAoDJ,QAAQC,KAA5D;;KARJ,MAUO;YACCI,aAAaC,SAASC,aAAT,CAAuB,OAAvB,CAAnB;eACSC,IAAT,CAAcC,WAAd,CAA0BJ,UAA1B;WACKH,SAAL,GAAiBG,UAAjB;;;;;;;;;;4BASsBK,GAA1B,EAA+BT,KAA/B,EAAsC;QAChCU,IAAJ,CADoC;;;;;;WAO5BA,OAAOpB,WAAWqB,IAAX,CAAgBF,GAAhB,CAAf,EAAsC;YAC9BG,qBAAN;oBACcC,UAAd,CACE,KAAKC,KADP,EAEE;eACSJ,KAAK,CAAL,CADT;gBAEUA,KAAK,CAAL,CAFV;;OAFF,EAOEA,KAAK,CAAL,CAPF;;;;;;;;;;;;;;;;;;oBAyBc;QAAA;OAAA;SAAA;;GAAlB,EAA8C;WACrC,KAAKK,oBAAL,CAA0B;aAAS,GAAEC,IAAK,IAAGC,GAAI,EAAvB;WAAA;;KAA1B,CAAP;;;;;;;;;;;;;;;;;uBAgBmBP,IAArB,EAA2B;UACnBQ,WAAW,KAAKvB,WAAtB;UACMwB,YAAY,MAAMJ,oBAAN,CAA2BL,IAA3B,CAAlB;;QACIQ,aAAa,KAAKvB,WAAtB,EAAmC;YAC3ByB,OAAOC,kBAAkBF,SAAlB,EAA6BT,IAA7B,CAAb;UACIY,KAAJ;;UACIZ,KAAKV,KAAT,EAAgB;YACV,CAAC,KAAKJ,WAAL,CAAiBc,KAAKV,KAAtB,CAAL,EAAmC;gBAC3BuB,aAAalB,SAASC,aAAT,CAAuB,OAAvB,CAAnB;qBACWN,KAAX,GAAmBU,KAAKV,KAAxB;eACKJ,WAAL,CAAiBc,KAAKV,KAAtB,IAA+BuB,UAA/B;eACKtB,SAAL,CAAeuB,UAAf,CAA0BhB,WAA1B,CAAsCe,UAAtC;;;gBAEM,KAAK3B,WAAL,CAAiBc,KAAKV,KAAtB,EAA6BsB,KAArC;OAPF,MAQO;gBACG,KAAKrB,SAAL,CAAeqB,KAAvB;;;YAEIG,UAAN,CAAiBL,IAAjB,EAAuBE,MAAMI,QAAN,CAAe7B,MAAtC;;;WAEKsB,SAAP;;;;;AAIJ,AAEA;;;;AAIA,SAASE,iBAAT,CAA2BF,SAA3B,EAAsC;OAAA;;CAAtC,EAAuD;MACjDQ,WAAY,IAAGR,SAAU,EAA7B;;MACIS,MAAJ,EAAY;gBACEA,MAAZ;;;SAEM,GAAED,QAAS,IAAGE,KAAM,GAA5B;;;;;"}
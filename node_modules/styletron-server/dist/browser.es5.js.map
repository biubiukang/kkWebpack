{"version":3,"file":"browser.es5.js","sources":["../src/base-obj-to-css.js","../src/cache-to-css.js","../src/cache-to-stylesheets.js","../src/cache-to-stylesheets-old-ie.js","../src/generate-html-string.js","../src/index.js"],"sourcesContent":["export default baseHandler;\n\nfunction baseHandler(key, objOrClassName) {\n  return key === 'pseudo'\n    ? pseudoObjToCss(objOrClassName)\n    : declToCss(key, objOrClassName);\n}\n\nfunction pseudoObjToCss(pseudoObj) {\n  let css = '';\n  for (const pseudoClass in pseudoObj) {\n    const propsObj = pseudoObj[pseudoClass];\n    for (const block in propsObj) {\n      css += declToCss(block, propsObj[block], pseudoClass);\n    }\n  }\n  return css;\n}\n\nfunction declToCss(block, className, pseudo) {\n  const selector = pseudo ? `${className}${pseudo}` : className;\n  return `.${selector}{${block}}`;\n}\n","import baseHandler from './base-obj-to-css';\n\nexport default cacheObjToCss;\n\n/*\n * Converts cache object to a CSS string\n * @param  {object} cacheObj Cache object\n * @return {string}          String of CSS\n */\nfunction cacheObjToCss(cacheObj) {\n  let mediaCss = '';\n  let css = '';\n  for (const key in cacheObj) {\n    if (key === 'media') {\n      mediaCss += mediaObjToCss(cacheObj[key]);\n      continue;\n    }\n    css += baseHandler(key, cacheObj[key]);\n  }\n  return css + mediaCss;\n}\n\nfunction mediaObjToCss(mediaObj) {\n  let css = '';\n  for (const query in mediaObj) {\n    const obj = mediaObj[query];\n    let mediaCss = '';\n    for (const key in obj) {\n      mediaCss += baseHandler(key, obj[key]);\n    }\n    css += `@media ${query}{${mediaCss}}`;\n  }\n  return css;\n}\n","import baseHandler from './base-obj-to-css';\n\nexport default cacheToStylesheets;\n\n/*\n * Converts cache object to a CSS string\n * @param  {object} cacheObj Cache object\n * @return {string}          String of CSS\n */\nfunction cacheToStylesheets(cacheObj) {\n  let mediaSheets;\n  let mainCss = '';\n  for (const key in cacheObj) {\n    if (key === 'media') {\n      mediaSheets = getMediaSheets(cacheObj[key]);\n      continue;\n    }\n    mainCss += baseHandler(key, cacheObj[key]);\n  }\n  const mainSheet = {\n    css: mainCss,\n  };\n  return mediaSheets ? [mainSheet].concat(mediaSheets) : [mainSheet];\n}\n\nfunction getMediaSheets(mediaObj) {\n  const stylesheets = [];\n  for (const query in mediaObj) {\n    const obj = mediaObj[query];\n    let mediaCss = '';\n    for (const key in obj) {\n      mediaCss += baseHandler(key, obj[key]);\n    }\n    stylesheets.push({\n      media: query,\n      css: mediaCss,\n    });\n  }\n  return stylesheets;\n}\n","import baseHandler from './base-obj-to-css';\n\n// https://blogs.msdn.microsoft.com/ieinternals/2011/05/14/stylesheet-limits-in-internet-explorer/\nconst IE9_RULE_LIMIT = 4095;\n\nexport default cacheToStylesheetsOldIE;\n\n/*\n * Converts cache object to a CSS string\n * @param  {object} cacheObj Cache object\n * @return {string}          String of CSS\n */\nfunction cacheToStylesheetsOldIE(cacheObj) {\n  const sheets = [];\n  let mediaSheets;\n  let mainCss = '';\n  let ruleCount = 0;\n  for (const key in cacheObj) {\n    if (key === 'media') {\n      mediaSheets = getMediaSheets(cacheObj[key]);\n      continue;\n    }\n    if (typeof cacheObj[key] === 'object') {\n      ruleCount += Object.keys(cacheObj[key]).length;\n    } else {\n      ruleCount++;\n    }\n    mainCss += baseHandler(key, cacheObj[key]);\n    // TODO: handle case of than 4095 unique values for a single property\n    if (ruleCount > IE9_RULE_LIMIT && mainCss) {\n      sheets.push({css: mainCss});\n      mainCss = '';\n      ruleCount = 0;\n    }\n  }\n  if (mainCss) {\n    sheets.push({css: mainCss});\n  }\n  return mediaSheets ? sheets.concat(mediaSheets) : sheets;\n}\n\nfunction getMediaSheets(mediaObj) {\n  const stylesheets = [];\n  for (const query in mediaObj) {\n    const obj = mediaObj[query];\n    let mediaCss = '';\n    let ruleCount = 0;\n    for (const key in obj) {\n      if (typeof obj[key] === 'object') {\n        ruleCount += Object.keys(obj[key]).length;\n      } else {\n        ruleCount++;\n      }\n      mediaCss += baseHandler(key, obj[key]);\n      // TODO: handle case of than 4095 unique values for a single property\n      if (ruleCount > IE9_RULE_LIMIT && mediaCss) {\n        stylesheets.push({media: query, css: mediaCss});\n        mediaCss = '';\n        ruleCount = 0;\n      }\n    }\n    if (mediaCss) {\n      stylesheets.push({\n        media: query,\n        css: mediaCss,\n      });\n    }\n  }\n  return stylesheets;\n}\n","export default generateHtmlString;\n\nfunction generateHtmlString(sheets, className) {\n  let html = '';\n  for (let i = 0; i < sheets.length; i++) {\n    const sheet = sheets[i];\n    const classAttr = className ? ` class=\"${className}\"` : '';\n    const mediaAttr = sheet.media ? ` media=\"${sheet.media}\"` : '';\n    html += `<style${classAttr}${mediaAttr}>${sheet.css}</style>`;\n  }\n  return html;\n}\n","import cacheToCss from './cache-to-css';\nimport cacheToStylesheets from './cache-to-stylesheets';\nimport cacheToStylesheetsOldIE from './cache-to-stylesheets-old-ie';\nimport generateHtmlString from './generate-html-string';\nimport StyletronCore from 'styletron-core';\n\n/**\n * A Styletron class for extracting styles during server-side rendering\n * @packagename styletron-server\n * @extends StyletronCore\n */\nclass StyletronServer extends StyletronCore {\n  /**\n   * Create a new StyletronServer instance\n   */\n  constructor(opts) {\n    super(opts);\n  }\n\n  /**\n   * Get an array of stylesheet objects\n   * @return {Array} Array of stylesheet objects\n   * @example\n   * const styletron = new StyletronServer();\n   *\n   * styletron.injectDeclaration({prop: 'color', val: 'red'});\n   * // → 'a'\n   * styletron.getStylesheets();\n   * // → [{css: '.a{color:red}'}]\n   */\n  getStylesheets() {\n    return cacheToStylesheets(this.cache);\n  }\n\n  /**\n   * Get an array of stylesheet objects, with ≤IE9 limit of max 4095 rules per stylesheet\n   * @return {Array} Array of stylesheet objects\n   * @example\n   * const styletron = new StyletronServer();\n   *\n   * styletron.injectDeclaration({prop: 'color', val: 'red'});\n   * // → 'a'\n   * styletron.getStylesheetsOldIE();\n   * // → [{css: '.a{color:red}'}]\n   */\n  getStylesheetsOldIE() {\n    return cacheToStylesheetsOldIE(this.cache);\n  }\n\n  /**\n   * Get a string of style elements for server rendering\n   * @return {String} The string of HTML\n   * @param {String} className=_styletron_hydrate_ Class name for style elements\n   * @example\n   * const styletron = new StyletronServer();\n   * styletron.injectDeclaration({prop: 'color', val: 'red'});\n   * // → 'a'\n   * styletron.getStylesheetsHtml();\n   * // → '<style class=\"_styletron_hydrate_\">.a{color:red}</style>'\n   * styletron.getStylesheetsHtml('custom_class');\n   * // → '<style class=\"custom_class\">.a{color:red}</style>'\n   */\n  getStylesheetsHtml(className = '_styletron_hydrate_') {\n    return generateHtmlString(this.getStylesheets(), className);\n  }\n\n  /**\n   * Get a string of style elements for server rendering, with ≤IE9 limit of max 4095 rules per sheet\n   * @return {String} The string of HTML\n   * @param {String} className=_styletron_hydrate_ Class name for style elements\n   * @example\n   * const styletron = new StyletronServer();\n   * styletron.injectDeclaration({prop: 'color', val: 'red'});\n   * // → 'a'\n   * styletron.getStylesheetsHtml();\n   * // → '<style class=\"_styletron_hydrate_\">.a{color:red}</style>'\n   * styletron.getStylesheetsHtml('custom_class');\n   * // → '<style class=\"custom_class\">.a{color:red}</style>'\n   */\n  getStylesheetsHtmlOldIE(className = '_styletron_hydrate_') {\n    return generateHtmlString(this.getStylesheetsOldIE(), className);\n  }\n\n  /**\n   * Get the CSS string. For hydrating styles on the client,\n   * [`getStylesheetsHtml`]{@link StyletronServer#getStylesheetsHtml} or [`getStylesheets`]{@link StyletronServer#getStylesheets} should be used instead.\n   * @return {String} The string of CSS\n   * @example\n   * const styletron = new StyletronServer();\n   *\n   * styletron.injectDeclaration({prop: 'color', val: 'red'});\n   * // → 'a'\n   * styletron.getCss();\n   * // → '.a{color:red}'\n   */\n  getCss() {\n    return cacheToCss(this.cache);\n  }\n}\n\nexport default StyletronServer;\n"],"names":["baseHandler","key","objOrClassName","pseudoObjToCss","declToCss","pseudoObj","css","pseudoClass","propsObj","block","className","pseudo","selector","cacheObjToCss","cacheObj","mediaCss","mediaObjToCss","mediaObj","query","obj","cacheToStylesheets","mediaSheets","mainCss","getMediaSheets","mainSheet","concat","stylesheets","push","IE9_RULE_LIMIT","cacheToStylesheetsOldIE","sheets","ruleCount","Object","keys","length","generateHtmlString","html","i","sheet","classAttr","mediaAttr","media","StyletronServer","opts","getStylesheets","cache","getStylesheetsOldIE","getStylesheetsHtml","getStylesheetsHtmlOldIE","getCss","cacheToCss","StyletronCore"],"mappings":"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"}